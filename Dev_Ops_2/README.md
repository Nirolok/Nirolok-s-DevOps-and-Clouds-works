# Очень плохой Docker файл

Для начала создаим Docker файл с "bad practices". В моём случае это указания `latest` тэга для базового образа, черезмерно большое колличесвто слоёв и использование `ADD` заместо `COPY`.
## Код "плохого" контейнера
```
# Указываем lates для образа
FROM python:latest 

#используем сильно больше слоёв чес нужно
RUN apt-get update
RUN apt-get install -y curl
RUN apt-get install -y vim
RUN apt-get install -y git

# Добавление вместо копирования
ADD . /app

# ещё слои
RUN pip install -r /app/requirements.txt

RUN useradd -m niroloks-user

USER niroloks-user

CMD ["python", "/app/main.py"]
```

## Описание плохих практик

### latest версия 
Ключевая проблема такого подхода заключатся в том, что в данном случае мы по сути получаем кота в мешке. Не всегда новейшие версии обладают достаточной стабильностью, к тому же в некоторых ситуациях может понадобится весьма конкретная версия образа, тэг latest же не позволит выбрать необходимую версию

### Черезмерно большое колличество слоёв
В данном случае всё упирается в оптимизацию, использование черезмерно большого колличества слоёв делает образ излишне тяжёлым, что может привести к уменьшению производительности.

### Использование `ADD` вместо `COPY`
Команда `ADD`, за имениием некоторого колличества дополнительных функций, является менее предсказуем, если задача состоит в простом копирывании файлов, лучше всего использовать пердназначенный для этого `СОРY`.

# "Работа над ошибками"

Для начала представим исправленный Docker файл
## Код исправленного Docker файл
```
# Вместо lates указываем версию python 3.10.5
FROM python:3.10.5 

# Объёденяем несколько команд на один слой и добавляем команду удаляющую временные файлы
RUN apt-get update && apt-get install -y \
    curl \
    vim \
    git \
    && rm -rf /var/lib/apt/lists/*

# не забываем заменить `ADD` на `COPY`
COPY . /app

# Объединяем установку зависимостей и очистку на один слой
RUN pip install --no-cache-dir -r /app/requirements.txt

RUN useradd -m niroloks-user

USER niroloks-user

CMD ["python", "/app/main.py"]
```
Теперь разберём, что конкретно мы исправили.

### Указываем точную версию образа

В исправленом примере вместо latest указываем точную версию (в нашем случае это `python:3.10.5`).

### Оптимизация использования слоёв

Вместо того чтобы устанавливать пакеты (`curl`, `vim`, `git`) на разных слоях, объеденяем всё в один, тем самым уменьшаем итоговый размер образа. Так же добавляем команду удаляющую временные файлы: `rm -rf /var/lib/apt/lists/*`.

### Используем `COPY` вместо `ADD`

Используем `COPY` заместо `ADD`, тем самым повышиваем стабильность Docker файла.

